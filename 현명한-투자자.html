<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="gramer.github.io/%ED%98%84%EB%AA%85%ED%95%9C-%ED%88%AC%EC%9E%90%EC%9E%90" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="1장 투자와 투기">

  <meta property="og:site_name" content="Zeno's digital garden">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">

  
  <meta property="og:description" content="1장 투자와 투기"/>
  

  
  <meta property="og:title" content="현명한 투자자">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2022-06-20T00:27:13+00:00">
  <meta property="article:author" content="gramer.github.io/">
  

  <meta property="og:url" content="gramer.github.io/%ED%98%84%EB%AA%85%ED%95%9C-%ED%88%AC%EC%9E%90%EC%9E%90" />

  

  <title>
    
      현명한 투자자 &mdash; Zeno's digital garden
    
  </title>
</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/"><b>Zeno's digital garden</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>현명한 투자자</h1>
    <time datetime="2022-06-20T00:26:21+00:00">
      Last updated on June 20, 2022
      
    </time>
  </div>

  <div id="notes-entry-container">
    <content>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#1장-투자와-투기">1장 투자와 투기</a></li>
<li class="toc-entry toc-h2"><a href="#2장-투자와-인플레이션">2장 투자와 인플레이션</a></li>
<li class="toc-entry toc-h2"><a href="#3장-지난-100년간의-주가흐름과-현재의-주가수준">3장 지난 100년간의 주가흐름과 현재의 주가수준</a></li>
<li class="toc-entry toc-h2"><a href="#4장-일반-투자자의-포트폴리오-전략-방어적-투자">4장 일반 투자자의 포트폴리오 전략: 방어적 투자</a></li>
<li class="toc-entry toc-h2"><a href="#5장-방어적-투자자의-주식투자">5장 방어적 투자자의 주식투자</a></li>
<li class="toc-entry toc-h2"><a href="#6장-공격적-투자자의-주식투자">6장 공격적 투자자의 주식투자</a></li>
<li class="toc-entry toc-h2"><a href="#7장-공격적-투자자의-포트폴리오">7장 공격적 투자자의 포트폴리오</a></li>
<li class="toc-entry toc-h2"><a href="#8장-펀드투자">8장 펀드투자</a></li>
<li class="toc-entry toc-h2"><a href="#9장-초보투자자의-종목분석">9장 초보투자자의 종목분석</a>
<ul>
<li class="toc-entry toc-h3"><a href="#채권분석">채권분석</a></li>
<li class="toc-entry toc-h3"><a href="#주식분석">주식분석</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#9장-eps">9장 EPS</a></li>
<li class="toc-entry toc-h2"><a href="#13장-상장회사-비교분석">13장 상장회사 비교분석</a></li>
<li class="toc-entry toc-h2"><a href="#14장-방어적-투자자의-종목-선정">14장 방어적 투자자의 종목 선정</a></li>
<li class="toc-entry toc-h2"><a href="#15장-공격적-투자자의-종목-선정">15장 공격적 투자자의 종목 선정</a></li>
<li class="toc-entry toc-h1"><a href="#thinking">Thinking</a></li>
</ul><h2 id="1장-투자와-투기">
<a class="anchor" href="#1%EC%9E%A5-%ED%88%AC%EC%9E%90%EC%99%80-%ED%88%AC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>1장 투자와 투기</h2>

<p>철저한 분석이 없다면 투기이다.
금리가 바뀌면 장기채권의 가겨은 매우 큰 폭으로 바뀐다.
채권과 주식 비중을 50:50 으로 조정하고 시장의 상황에 따라서 비율 조정을 한다.</p>

<h2 id="2장-투자와-인플레이션">
<a class="anchor" href="#2%EC%9E%A5-%ED%88%AC%EC%9E%90%EC%99%80-%EC%9D%B8%ED%94%8C%EB%A0%88%EC%9D%B4%EC%85%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>2장 투자와 인플레이션</h2>

<p>부동산과 금, 은 투자는 인플레이션에 따라서 오를 것이라 생각하지만 그렇지 않을 수도 있다.
저자는 잘 모르는 분야보다, 주식이 더 안정적으로 생각하는 것으로 보인다.</p>

<h2 id="3장-지난-100년간의-주가흐름과-현재의-주가수준">
<a class="anchor" href="#3%EC%9E%A5-%EC%A7%80%EB%82%9C-100%EB%85%84%EA%B0%84%EC%9D%98-%EC%A3%BC%EA%B0%80%ED%9D%90%EB%A6%84%EA%B3%BC-%ED%98%84%EC%9E%AC%EC%9D%98-%EC%A3%BC%EA%B0%80%EC%88%98%EC%A4%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>3장 지난 100년간의 주가흐름과 현재의 주가수준</h2>

<p>확신이 서지 않는다면 주식 비중을 늘리지 않는다.
과거의 흐름을 알면 현재를 알 수 있다.</p>

<h2 id="4장-일반-투자자의-포트폴리오-전략-방어적-투자">
<a class="anchor" href="#4%EC%9E%A5-%EC%9D%BC%EB%B0%98-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%ED%8F%AC%ED%8A%B8%ED%8F%B4%EB%A6%AC%EC%98%A4-%EC%A0%84%EB%9E%B5-%EB%B0%A9%EC%96%B4%EC%A0%81-%ED%88%AC%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>4장 일반 투자자의 포트폴리오 전략: 방어적 투자</h2>

<p>목표 수익률은 투자자가 기꺼이 투입할 수 있는 지적 노력의 양
채권 수익률이 높을 때, 주식을 25%까지 낮추고 채권으로 유지하다가, 배당시점에 다시 주식을 구매한다.
과세 채권과 비과세 채권</p>

<h2 id="5장-방어적-투자자의-주식투자">
<a class="anchor" href="#5%EC%9E%A5-%EB%B0%A9%EC%96%B4%EC%A0%81-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%EC%A3%BC%EC%8B%9D%ED%88%AC%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>5장 방어적 투자자의 주식투자</h2>

<p>주식선정 4대 기준</p>

<ul>
  <li>분산투자 10~30</li>
  <li>재무구조가 건전한 대기업 중심</li>
  <li>장기간 배당 지급한 기업 중</li>
  <li>7년 평균 이익을 고려해서 매수가격 상한선을 설정
    <ul>
      <li>7년평균이익의 25배 이하 또는 최근 12개월 이익의 20배 이하</li>
      <li><a href="https://finance.naver.com/sise/dividend_list.nhn?field=per&amp;sosok=KOSPI&amp;ordering=desc&amp;page=5">배당주 확인하기</a></li>
    </ul>
  </li>
  <li>보통주 자본이 50% 이상</li>
  <li>공기업은 보통주 자본이 30% 이상</li>
</ul>

<h2 id="6장-공격적-투자자의-주식투자">
<a class="anchor" href="#6%EC%9E%A5-%EA%B3%B5%EA%B2%A9%EC%A0%81-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%EC%A3%BC%EC%8B%9D%ED%88%AC%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>6장 공격적 투자자의 주식투자</h2>

<ul>
  <li>비우량 채권은 가급적 사지 말자</li>
  <li>이자보상비율 (영업이익 / 이자비용) 이 높을 수록</li>
  <li>외국 채권은 의문</li>
</ul>

<h2 id="7장-공격적-투자자의-포트폴리오">
<a class="anchor" href="#7%EC%9E%A5-%EA%B3%B5%EA%B2%A9%EC%A0%81-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%ED%8F%AC%ED%8A%B8%ED%8F%B4%EB%A6%AC%EC%98%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>7장 공격적 투자자의 포트폴리오</h2>

<ul>
  <li>성장주 투자가 지수투자보나 낫지 않다.</li>
  <li>소외된 대형주에게 투자 (S&amp;P, kodex 200 기준으로 per 와 배당률을 확인한 뒤에 하위 10개종목을 확인한다)
    <ul>
      <li>PER 가 과거 PER의 평균보다 낮아야 한다.</li>
    </ul>
  </li>
  <li>염가 종목을 매수하자.
    <ul>
      <li>채무 차감 후 순운전자본 &gt; 시가총액</li>
    </ul>
  </li>
  <li>방어적 투자자는 유형가치에 1/3 을 초과하지 않는 종목</li>
  <li>투자자는 주식을 보유하는 것, 시장흐름</li>
</ul>

<h2 id="8장-펀드투자">
<a class="anchor" href="#8%EC%9E%A5-%ED%8E%80%EB%93%9C%ED%88%AC%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>8장 펀드투자</h2>

<h2 id="9장-초보투자자의-종목분석">
<a class="anchor" href="#9%EC%9E%A5-%EC%B4%88%EB%B3%B4%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%EC%A2%85%EB%AA%A9%EB%B6%84%EC%84%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>9장 초보투자자의 종목분석</h2>

<h3 id="채권분석">
<a class="anchor" href="#%EC%B1%84%EA%B6%8C%EB%B6%84%EC%84%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>채권분석</h3>

<p>채권분석에 가장 중요한 기준은 이자보상비율(영업이익 / 이자비용)
저자는 영업이익 / 부채원금 를 추천, 제조는 33%, 공기업은 22%, 철도회사는 25%
채권 옆 숫자는 발행회차
국채는 이자 + 발행연도이다. 국고0375-1306 (3.75%, 13년 06월)</p>

<h3 id="주식분석">
<a class="anchor" href="#%EC%A3%BC%EC%8B%9D%EB%B6%84%EC%84%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>주식분석</h3>

<p>자본화 계수? 이건 머지?</p>

<ol>
  <li>일반적인 장기 전망</li>
  <li>경영: 경영자가 교체 되는 경우를 주목</li>
  <li>재무건정성과 자본구조</li>
  <li>배당실적: 장기간 배당을 주었다면</li>
  <li>배당성향</li>
</ol>

<p>성장주에 적용하는 자본화 계수</p>

<ul>
  <li>EPS * (8.5 +2 * ‘기대성장률’), 7~ 10년 동안의 평균연간성장률</li>
</ul>

<p>삼성전자 예시,
3,841 * (8.5 + 2 * 7) = 86,422.5, 연간 7%의 성장을 원하고 있는가?</p>

<p>금리 상승에 대한 부분도 고려해야 한다.</p>

<h2 id="9장-eps">
<a class="anchor" href="#9%EC%9E%A5-eps" aria-hidden="true"><span class="octicon octicon-link"></span></a>9장 EPS</h2>

<p>1년 실적을 너무 진지하게 받아 들이지 마라
당해 연도에는 특별비용, 과거 손실 덕분에 얻게 되는 소득세공제, 발행한 전환사채
전환사채에 대한 감가상각 방식에 따라,
연구개발비에 대한 인식 방식에 따라,
재고자산 평가기법으로 선입선출, 후입선출 방식에 따라
EPS 는 달라진다.
저자가 제안하는 방식은 3년 성장률, 10년 전 3년 성장률</p>

<h2 id="13장-상장회사-비교분석">
<a class="anchor" href="#13%EC%9E%A5-%EC%83%81%EC%9E%A5%ED%9A%8C%EC%82%AC-%EB%B9%84%EA%B5%90%EB%B6%84%EC%84%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>13장 상장회사 비교분석</h2>

<ul>
  <li>수익성: ROE</li>
  <li>안정성: 직전 3년 평균 EPS 대비 최대하락률, kospi 평균 등의 지표도 함께 고려</li>
  <li>성장성: PER</li>
  <li>재무상태: 부채비율, 장기부채비율</li>
  <li>배당: 3년 배당</li>
</ul>

<p>포트폴리오 편입에 필요한 7개 조건</p>

<ul>
  <li>충분한 규모</li>
  <li>매우 건전한 재무상태</li>
  <li>최근 10년동안 적자사례 없음</li>
  <li>최근 20년 이상 연속 배당지급 실적</li>
  <li>EPS 10년 성장률이 33%이상</li>
  <li>PER 15이하</li>
  <li>PBR 1.5이하</li>
</ul>

<h2 id="14장-방어적-투자자의-종목-선정">
<a class="anchor" href="#14%EC%9E%A5-%EB%B0%A9%EC%96%B4%EC%A0%81-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%EC%A2%85%EB%AA%A9-%EC%84%A0%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>14장 방어적 투자자의 종목 선정</h2>

<p>다우지수 30종목 모두 동일 금액 투자</p>

<p>정략분석을 통해 선별</p>

<ol>
  <li>충분한 규모 : 매출규모와 총자산</li>
  <li>매우 건전한 재무상태:
    <ul>
      <li>유동비율 200% 이상</li>
      <li>부채비율 200% 미만</li>
    </ul>
  </li>
</ol>

<p>대부분 위와 동일하고, PBR, PER 관점</p>

<p>PER * PBR ≤ 22.5</p>

<p>공익기업은 유동비율 기준을 적용할 필요가 없다.</p>

<h2 id="15장-공격적-투자자의-종목-선정">
<a class="anchor" href="#15%EC%9E%A5-%EA%B3%B5%EA%B2%A9%EC%A0%81-%ED%88%AC%EC%9E%90%EC%9E%90%EC%9D%98-%EC%A2%85%EB%AA%A9-%EC%84%A0%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>15장 공격적 투자자의 종목 선정</h2>

<p>주가를 예측하기는 어렵다.</p>

<p>주가흐름은 운?</p>

<p>현재주가는 미래가치가 충분히 반영되어 있다.</p>

<p>그레이엄-뉴먼기법</p>

<ul>
  <li>순수헤지: 전환사채, 전환우선주를 매수하고 보통주를 매도한다. 동일하게 구성</li>
  <li>염가종목 :</li>
</ul>

<hr>

<h1 id="thinking">
<a class="anchor" href="#thinking" aria-hidden="true"><span class="octicon octicon-link"></span></a>Thinking</h1>

<ul>
  <li>저차처럼 시장이 과열 된 건 어떻게 판단할까? (분석자료를 통해?)</li>
  <li>내가 삼성전자 배당일 인정기준 시점에 1억을 투자하는 건 어떨까?
    <ul>
      <li>10000000 / 8000 = 1250</li>
      <li>2,994 * 1250 = 3,742,500</li>
    </ul>
  </li>
  <li>방어적 관점으로 70%
    <ul>
      <li>우량 가치주</li>
      <li>연속배당이 있는지?</li>
      <li>보통주 자본이 50% 이상</li>
      <li>EPS 10년 성장률이 33%이상</li>
      <li>PER 15이하</li>
      <li>PBR 1.5이하</li>
    </ul>
  </li>
  <li>공격적 관점으로 30%</li>
</ul>

    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      

      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"1105250","target":"0"},{"source":"1783189036595305315139779527442417148144190962786599794647","target":"36485673071"},{"source":"1173349929","target":"1173349929"},{"source":"0","target":"1105250"}],"nodes":[{"id":"0","path":"/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%91%EC%8B%AC-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%A4%EA%B3%84","label":"데이터 중심 애플리케이션 설계"},{"id":"0","path":"/%EC%A0%9C%ED%85%94%EC%B9%B4%EC%8A%A4%ED%85%90","label":"제텔카스텐"},{"id":"0","path":"/%ED%98%84%EB%AA%85%ED%95%9C-%ED%88%AC%EC%9E%90%EC%9E%90","label":"현명한 투자자"},{"id":"1783189036595305315139779527442417148144190962786599794647","path":"/gremlin-applicatoin-attack","label":"Gremlin Application Layer Fault Injection"},{"id":"36485673071","path":"/gremlin","label":"Gremlin 관련"},{"id":"2356180470493017000564695","path":"/anomaly-detection","label":"Anomaly detection"},{"id":"132794565206938727014822709","path":"/google-spreadsheet","label":"Google spreadsheet"},{"id":"1173349929","path":"/jekyll","label":"Jekyll"},{"id":"1105250","path":"/note","label":"Note"},{"id":"8345289848942075317846035406687072346852","path":"/springboot-health-check","label":"About SpringBootHealth Check"}]}

    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source === el.id || l.target === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source}-${edge.target}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>

</main>
      <footer>This is the footer. Include anything you'd like here, like a link to an <a class="internal-link" href="/about">About</a> page.
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
